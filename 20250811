CREATE DICTIONARY dict_exip_pair_flag12
(
    IP String,
    SIG_NM String
)
PRIMARY KEY (IP, SIG_NM)
SOURCE(CLICKHOUSE(TABLE '
    SELECT IP, SIG_NM
    FROM EXIP
    WHERE SIG_NM IS NOT NULL AND FLAG IN (''1'',''2'')
'))
LAYOUT(COMPLEX_KEY_HASHED())
LIFETIME(MIN 300 MAX 600);

CREATE DICTIONARY dict_exip_pair_flag13
(
    IP String,
    SIG_NM String
)
PRIMARY KEY (IP, SIG_NM)
SOURCE(CLICKHOUSE(TABLE '
    SELECT IP, SIG_NM
    FROM EXIP
    WHERE SIG_NM IS NOT NULL AND FLAG IN (''1'',''3'')
'))
LAYOUT(COMPLEX_KEY_HASHED())
LIFETIME(MIN 300 MAX 600);

CREATE DICTIONARY dict_exip_ip_flag12
(
    IP String
)
PRIMARY KEY IP
SOURCE(CLICKHOUSE(TABLE '
    SELECT IP
    FROM EXIP
    WHERE SIG_NM IS NULL AND FLAG IN (''1'',''2'')
'))
LAYOUT(HASHED())
LIFETIME(MIN 300 MAX 600);


CREATE DICTIONARY dict_exip_ip_flag13
(
    IP String
)
PRIMARY KEY IP
SOURCE(CLICKHOUSE(TABLE '
    SELECT IP
    FROM EXIP
    WHERE SIG_NM IS NULL AND FLAG IN (''1'',''3'')
'))
LAYOUT(HASHED())
LIFETIME(MIN 300 MAX 600);


          -- (SIP, STRTITLE) NOT IN ...
          AND NOT dictHas('dict_exip_pair_flag12', (SIP, STRTITLE))
          -- (DIP, STRTITLE) NOT IN ...
          AND NOT dictHas('dict_exip_pair_flag13', (DIP, STRTITLE))
          -- SIP NOT IN ...
          AND NOT dictHas('dict_exip_ip_flag12', SIP)
          -- DIP NOT IN ...
          AND NOT dictHas('dict_exip_ip_flag13', DIP)
