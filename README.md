
CREATE TABLE TEST
(
    OCCR_DT String,
    PKT_SEQ String, 
    TMSTART String,
    STRTITLE String,
    SIP String,
    DIP String,
    COUNT String,

    INDEX idx_dt OCCR_DT TYPE set(1000) GRANULARITY 4,
    INDEX idx_title STRTITLE TYPE set(1000) GRANULARITY 4,
    INDEX idx_sip SIP TYPE set(1000) GRANULARITY 4,
    INDEX idx_dip DIP TYPE set(1000) GRANULARITY 4
)
ENGINE = MergeTree
PARTITION BY toYYYYMMDD(toDateTime(OCCR_DT, 'Asia/Seoul')) 
ORDER BY (OCCR_DT, STRTITLE, PKT_SEQ, TMSTART);



ALTER TABLE test ADD INDEX idx_sip (SIP) TYPE set(1000) GRANULARITY 4;
ALTER TABLE test MATERIALIZE INDEX idx_sip;
OPTIMIZE TABLE test FINAL;
SET max_threads = 8;


CREATE TABLE TEST_IP_JOIN 
ENGINE = Join(ANY, LEFT, IP String, TITLE String)
AS SELECT IP, TITLE FROM TEST_IP WHERE USE_YN = 'Y';


